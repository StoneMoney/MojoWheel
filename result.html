<html>
<head>
<title>MojoWheel output</title>
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
<style>
.hidden {
	visibility:hidden;
}
table {
	width:98vw;
	height:90vh;
	background-color:#6441A4;
	text-align:center;
	font-family:sans-serif;
	font-weight:bold;
	color:#3b3b3b;
	border-width: 8px;
	border-radius: 5px;
	border-style:solid;
	border-color:#3b3b3b;
}
img {
	width: 100%;
	height: auto;
}
</style>
</head>
<body>
<table id="table">
	<tr style="height:17vh;	font-size:15vh;">
		<td rowspan="2" style="height:53vh;width:9vw"><img src="bit.png"/></td>
		<td>SPINNING WHEEL...</td>
		<td rowspan="2" style="height:53vh;width:9vw"><img src="bit.png"/></td>
	</tr>
	<tr>
		<td id="selection" style="height:53vh;width:80vw;font-size:24vh;color:white;text-shadow: 3px 3px black">NO CONNECTION</td>
	</tr>
</table>
<script>
var click = new Audio('spinningsound.ogg');
var wheelArray = {};
Array.prototype.removeValue = function(name, value){
   var array = $.map(this, function(v,i){
      return v[name] === value ? null : v;
   });
   this.length = 0; //clear original array
   this.push.apply(this, array); //push all elements except the one we want to delete
}
var pattern1 = "^sendtowheel ([0-9]+) (.*)";
var re1 = new RegExp(pattern1,"i");
//create a new WebSocket object.
websocket = new WebSocket("ws://localhost:8080/");
websocket.onopen = function() {
	$('#table').fadeOut('slow');
};
websocket.onclose = function() {
	$('#table').fadeIn('slow');
	document.getElementById("selection").innerHTML = "LOST CONNECTION (REFRESHING)";
	setTimeout(function() {
		location.reload();
	},25000)
};
websocket.onmessage = function(ev) {
	if (re1.test(ev.data)) {
		var message = ev.data;
		var matches = message.match(pattern1);
		wheelArray.push(matches[2]);
	};
	if (ev.data.startsWith("spin")) {
		var finalSelection;
		//begin insane animation spree
		wheelArray=[];
		websocket.send("requesting");
		$('#table').fadeIn('fast');
		setTimeout(function() {
			finalSelection = wheelArray[Math.floor(Math.random() * wheelArray.length)];
		},10);
		setTimeout(function() {
			document.getElementById('selection').innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			click.play();
		},25);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},75);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},125);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},160);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},225);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},270);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},320);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},370);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},440);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},480);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},550);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},600);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},660);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},710);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},770);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},830);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},890);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},950);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1020);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1100);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1150);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1250);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1300);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1370);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1450);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1535);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1600);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1690);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1780);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1870);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1960);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},2070);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},2160);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},2280);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},2400);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},2535);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},2660);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},2810);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},3000);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = finalSelection;
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
			websocket.send("wheelselected "+finalSelection);
		},3200);
		setTimeout(function() {
			$('#table').fadeOut('slow');
		},7200);
	}
}
</script>
</body>
</html>
