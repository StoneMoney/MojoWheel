<html>
<head>
<title>MojoWheel output</title>
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
<style>
.hidden {
	visibility:hidden;
}
table {
	width:98vw;
	height:90vh;
	background-color:#6441A4;
	text-align:center;
	font-family:sans-serif;
	font-weight:bold;
	color:#3b3b3b;
	border-width: 8px;
	border-radius: 5px;
	border-style:solid;
	border-color:#3b3b3b;
}
img {
	width: 100%;
	height: auto;
}
</style>
</head>
<body>
<table id="table">
	<tr style="height:17vh;	font-size:15vh;">
		<td rowspan="2" style="height:53vh;width:9vw"><img id="sideimages1" src="bit.png"/></td>
		<td id="infotext">SPINNING WHEEL...</td>
		<td rowspan="2" style="height:53vh;width:9vw"><img id="sideimages2" src="bit.png"/></td>
	</tr>
	<tr>
		<td id="selection" style="height:53vh;width:80vw;font-size:24vh;color:white;text-shadow: 3px 3px black">NO CONNECTION</td>
	</tr>
</table>
<script>
var click = new Audio('spinningsound.ogg');
var isSpinning = false;
var playsound = true;
var showprice = false;
var theprice = "100 bits";
var onscreenprice = "10";
var cooldownprice = "1";
var sideimage = "bit.png";
var wheelArray = {};
Array.prototype.removeValue = function(name, value){
   var array = $.map(this, function(v,i){
      return v[name] === value ? null : v;
   });
   this.length = 0; //clear original array
   this.push.apply(this, array); //push all elements except the one we want to delete
}
var pattern1 = "^sendtowheel ([0-9]+) (.*)";
var re1 = new RegExp(pattern1,"i");
var pattern2 = "^config ([A-Z]+|[a-z]+) (.*)";
var re2 = new RegExp(pattern2,"i");
//create a new WebSocket object.
function updateInterval() {
	clearInterval()
	setInterval(function() {
		if(showprice && !isSpinning) {
			$('#table').fadeIn('slow');
			document.getElementById("selection").innerHTML = "for "+theprice+"!";
			document.getElementById("infotext").innerHTML = "SPIN THE WHEEL...";
			setTimeout(function() {
				$('#table').fadeOut('slow');
				document.getElementById("infotext").innerHTML = "SPINNING WHEEL...";
			},(parseInt(onscreenprice)*1000));
		}
	},(parseInt(onscreenprice)*6000));
}
websocket = new WebSocket("ws://localhost:8080/");
websocket.onopen = function() {
	$('#table').fadeOut('slow');
	websocket.send("config-request");
	setTimeout(function() {
		updateInterval();
	},300);
};
websocket.onclose = function() {
	$('#table').fadeIn('slow');
	document.getElementById("selection").innerHTML = "LOST CONNECTION (REFRESHING)";
	setTimeout(function() {
		location.reload();
	},25000)
};
websocket.onmessage = function(ev) {
	if (re1.test(ev.data)) {
		var message = ev.data;
		var matches = message.match(pattern1);
		wheelArray.push(matches[2]);
	};
	if (re2.test(ev.data)) {
		var message = ev.data;
		var matches = message.match(pattern2);
		console.log(matches);
		if(matches[1]=="backgroundcolor") {
			try {
				document.getElementById("table").style.backgroundColor = matches[2];
			} catch(err) {
				console.log("Color application failed!")
			}
		} else if (matches[1]=="textcolor") {
			try {
				document.getElementById("table").style.color = matches[2];
			} catch(err) {
				console.log("Color application failed!")
			}
		} else if (matches[1]=="playsound") {
			if(matches[2] == "true") {
				playsound = true
			} else if (matches[2] == "false") {
				playsound = false
			}
		} else if (matches[1]=="sideimage") {
			try {
				document.getElementById("sideimages1").src = matches[2];
				document.getElementById("sideimages2").src = matches[2];
			} catch(err) {
				console.log(err);
			}
		} else if (matches[1]=="showprice") {
			if(matches[2] == "true") {
				showprice = true
			} else if (matches[2] == "false") {
				showprice = false
			}
		} else if (matches[1]=="theprice") {
			theprice = matches[2]
		} else if (matches[1]=="cooldownprice") {
			cooldownprice = matches[2]
			updateInterval();
		} else if (matches[1]=="onscreenprice") {
			onscreenprice = matches[2]
		}
	};
	if (ev.data.startsWith("spin")) {
		var finalSelection;
		//begin insane animation spree
		wheelArray=[];
		websocket.send("wheel-requesting");
		$('#table').fadeIn('fast');
		setTimeout(function() {
			finalSelection = wheelArray[Math.floor(Math.random() * wheelArray.length)];
		},10);
		setTimeout(function() {
			document.getElementById('selection').innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			isSpinning = true;
			if(playsound) {
				click.play();
			}
		},25);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},75);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},125);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},160);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},225);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},270);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},320);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},370);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},440);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},480);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},550);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},600);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},660);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},710);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},770);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},830);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},890);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},950);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1020);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1100);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1150);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1250);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1300);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1370);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1450);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1535);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1600);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1690);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1780);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1870);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},1960);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},2070);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},2160);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},2280);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},2400);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},2535);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},2660);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},2810);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = wheelArray[Math.floor(Math.random() * wheelArray.length)];
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
		},3000);
		setTimeout(function() {
			document.getElementById("selection").innerHTML = finalSelection;
			if(document.getElementById("selection").innerHTML.length > 25) {
				document.getElementById("selection").style.fontSize = "14vh";
			} else {
				document.getElementById("selection").style.fontSize = "24vh";
			}
			websocket.send("wheelselected "+finalSelection);
		},3200);
		setTimeout(function() {
			$('#table').fadeOut('slow');
			isSpinning = false;
		},7200);
	}
}
</script>
</body>
</html>
